---
import Layout from '../layouts/Layout.astro';
import { profile } from '../data/profile';
import { useTranslations, defaultLang, getTranslatedPath, type Lang } from '../i18n';

const locale: Lang = defaultLang;
const translations = useTranslations(locale);

// Helper to format date range
function formatDateRange(startDate: string, endDate?: string, locale: 'en' | 'zh-tw' = 'en'): string {
  const formatDate = (date: string) => {
    if (date.length === 4) return date; // Year only
    const [year, month] = date.split('-');
    const monthNum = parseInt(month);
    const monthNames = {
      en: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
      'zh-tw': ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'],
    };
    return `${monthNames[locale][monthNum - 1]} ${year}`;
  };
  
  const start = formatDate(startDate);
  const end = endDate ? formatDate(endDate) : translations.about.present;
  return `${start} - ${end}`;
}
---

<Layout 
  title={`${profile.name} - Resume`}
  description={profile.bio[locale]}
>
  <main class="resume-page">
    <!-- Print Hint (only visible on screen) -->
    <div class="print-hint no-print">
      <strong>üí° Tip:</strong> To save as PDF, click the "Print / Save PDF" button below and choose "Save as PDF" as your printer.
    </div>

    <!-- Print Button -->
    <div class="print-actions no-print">
      <button onclick="window.print()" class="btn btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 6 2 18 2 18 9"></polyline>
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
          <rect x="6" y="14" width="12" height="8"></rect>
        </svg>
        Print / Save PDF
      </button>
      <a href={getTranslatedPath('/about', locale)} class="btn btn-secondary">
        ‚Üê Back to About
      </a>
    </div>

    <!-- Resume Content -->
    <article class="resume-content">
      <!-- Header -->
      <header class="resume-header">
        <h1>{profile.name}</h1>
        <p class="subtitle">{profile.title[locale]}</p>
        <div class="contact-info">
          {profile.social.email && <span>üìß {profile.social.email}</span>}
          <span>üìç {profile.location}</span>
          {profile.social.linkedin && <span>üîó linkedin.com/in/lung-yu-tsai-633865100</span>}
        </div>
      </header>

      <!-- Bio -->
      <section class="resume-section bio-section">
        <p class="bio-text">{profile.bio[locale]}</p>
      </section>

      <!-- Experience -->
      <section class="resume-section">
        <h2 class="section-title">{translations.about.sections.experience}</h2>
        {profile.experience.map((exp) => (
          <div class="timeline-item">
            <div class="timeline-header">
              <div>
                <h3 class="timeline-company">{exp.company}</h3>
                <p class="timeline-position">{exp.position[locale]}</p>
              </div>
              <div class="timeline-meta">
                <span class="timeline-date">{formatDateRange(exp.startDate, exp.endDate, locale)}</span>
                <span class="timeline-location">{exp.location}</span>
              </div>
            </div>
            <ul class="timeline-description">
              {exp.description[locale].map((item) => (
                <li>{item}</li>
              ))}
            </ul>
            {exp.technologies && (
              <div class="timeline-tech">
                {exp.technologies.map((tech) => (
                  <span class="tag">{tech}</span>
                ))}
              </div>
            )}
          </div>
        ))}
      </section>

      <!-- Certifications -->
      <section class="resume-section">
        <h2 class="section-title">{translations.about.sections.certifications}</h2>
        <div class="certs-grid">
          {profile.certifications.map((cert) => (
            <div class="cert-card">
              <span class="cert-name">{cert.name}</span>
              <span class="cert-issuer">{cert.issuer}</span>
            </div>
          ))}
        </div>
      </section>

      <!-- Speaking -->
      <section class="resume-section">
        <h2 class="section-title">{translations.about.sections.speaking}</h2>
        <div class="speaking-list">
          {profile.speaking.slice(0, 5).map((talk) => (
            <div class="speaking-item">
              <div class="speaking-header">
                <span class="speaking-title">{talk.title[locale]}</span>
                <span class="speaking-date">{talk.date.split('-')[0]}</span>
              </div>
              <span class="speaking-event">{talk.event}</span>
            </div>
          ))}
        </div>
      </section>

      <!-- Skills -->
      <section class="resume-section">
        <h2 class="section-title">{translations.about.sections.skills}</h2>
        <div class="skills-grid">
          {profile.skills.map((category) => (
            <div class="skill-category">
              <h4 class="skill-category-name">{category.name[locale]}</h4>
              <div class="skill-tags">
                {category.skills.map((skill) => (
                  <span class="tag">{skill}</span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- Education -->
      <section class="resume-section">
        <h2 class="section-title">{translations.about.sections.education}</h2>
        {profile.education.map((edu) => (
          <div class="education-item">
            <div class="education-header">
              <div>
                <h3 class="education-school">{edu.school}</h3>
                <p class="education-degree">{edu.degree[locale]} - {edu.field[locale]}</p>
              </div>
              <span class="education-date">{edu.startDate} - {edu.endDate || translations.about.present}</span>
            </div>
          </div>
        ))}
      </section>
    </article>
  </main>
</Layout>

<style>
  .resume-page {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
  }

  .print-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn-primary {
    background-color: var(--color-primary);
    color: white;
    border: none;
  }

  .btn-primary:hover {
    background-color: var(--color-primary-hover);
  }

  .btn-secondary {
    background-color: var(--color-bg-secondary);
    color: var(--color-text);
    border: 1px solid var(--color-border);
  }

  .btn-secondary:hover {
    background-color: var(--color-bg-tertiary);
  }

  .resume-content {
    background-color: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    padding: 2rem;
  }

  .resume-header {
    text-align: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid var(--color-primary);
  }

  .resume-header h1 {
    font-size: 2rem;
    margin-bottom: 0.25rem;
    color: var(--color-text);
  }

  .resume-header .subtitle {
    font-size: 1.125rem;
    color: var(--color-primary);
    margin-bottom: 0.75rem;
  }

  .contact-info {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    font-size: 0.875rem;
    color: var(--color-text-secondary);
  }

  .resume-section {
    margin-bottom: 1.5rem;
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--color-border);
  }

  .bio-text {
    color: var(--color-text-secondary);
    line-height: 1.6;
    white-space: pre-line;
  }

  .timeline-item {
    margin-bottom: 1.25rem;
    padding-bottom: 1.25rem;
    border-bottom: 1px solid var(--color-border);
  }

  .timeline-item:last-child {
    border-bottom: none;
  }

  .timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 0.5rem;
  }

  .timeline-company {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text);
    margin: 0;
  }

  .timeline-position {
    font-size: 0.9rem;
    color: var(--color-primary);
    margin: 0;
  }

  .timeline-meta {
    text-align: right;
    flex-shrink: 0;
  }

  .timeline-date {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    display: block;
  }

  .timeline-location {
    font-size: 0.75rem;
    color: var(--color-text-tertiary);
  }

  .timeline-description {
    margin: 0.5rem 0;
    padding-left: 1.25rem;
    color: var(--color-text-secondary);
    font-size: 0.875rem;
  }

  .timeline-description li {
    margin-bottom: 0.25rem;
  }

  .timeline-tech {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    margin-top: 0.5rem;
  }

  .certs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 0.75rem;
  }

  .cert-card {
    display: flex;
    flex-direction: column;
    padding: 0.75rem;
    background: var(--color-bg-secondary);
    border-radius: 0.5rem;
    border: 1px solid var(--color-border);
  }

  .cert-name {
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--color-text);
  }

  .cert-issuer {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
  }

  .speaking-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .speaking-item {
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--color-border);
  }

  .speaking-item:last-child {
    border-bottom: none;
  }

  .speaking-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
  }

  .speaking-title {
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--color-text);
  }

  .speaking-date {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    flex-shrink: 0;
  }

  .speaking-event {
    font-size: 0.85rem;
    color: var(--color-primary);
  }

  .skills-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
  }

  .skill-category-name {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 0.5rem;
  }

  .skill-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
  }

  .tag {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    background: var(--color-bg-tertiary);
    color: var(--color-text-secondary);
    border-radius: 0.25rem;
    font-size: 0.75rem;
  }

  .education-item {
    margin-bottom: 1rem;
  }

  .education-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
  }

  .education-school {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text);
    margin: 0;
  }

  .education-degree {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin: 0;
  }

  .education-date {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    flex-shrink: 0;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .resume-page {
      padding: 1rem;
    }

    .resume-content {
      padding: 1.5rem;
    }

    .timeline-header,
    .speaking-header,
    .education-header {
      flex-direction: column;
      gap: 0.25rem;
    }

    .timeline-meta,
    .speaking-date,
    .education-date {
      text-align: left;
    }

    .contact-info {
      flex-direction: column;
      gap: 0.25rem;
    }
  }
</style>
