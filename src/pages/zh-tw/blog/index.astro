---
/**
 * Blog Page (Traditional Chinese)
 */
import Layout from '../../../layouts/Layout.astro';
import { useTranslations, getTranslatedPath } from '../../../i18n';

const lang = 'zh-tw';
const t = useTranslations(lang);

// Mock blog posts data
const posts = [
  {
    slug: 'sql-injection-deep-dive',
    title: 'SQL Injection 深入解析：從偵測到防禦',
    excerpt: '全面了解現代 Web 應用程式中 SQL 注入漏洞的識別與防範指南。',
    date: '2024-01-15',
    readTime: 12,
    tags: ['資安', 'Web', '資料庫'],
  },
  {
    slug: 'secure-cicd-github-actions',
    title: '使用 GitHub Actions 建構安全的 CI/CD 流程',
    excerpt: '逐步指南：在部署流程中實施安全掃描、金鑰管理與合規檢查。',
    date: '2024-01-08',
    readTime: 15,
    tags: ['DevSecOps', 'GitHub', '自動化'],
  },
  {
    slug: 'aws-security-startups',
    title: '新創公司的 AWS 安全最佳實踐',
    excerpt: '在 AWS 上建構的新創公司必備安全配置與實踐，從 IAM 到網路安全。',
    date: '2024-01-01',
    readTime: 10,
    tags: ['雲端', 'AWS', '資安'],
  },
  {
    slug: 'xss-prevention-guide',
    title: 'XSS 防護：開發者完整指南',
    excerpt: '了解跨站腳本攻擊並在應用程式中實施有效的防護策略。',
    date: '2023-12-20',
    readTime: 14,
    tags: ['資安', 'Web', 'JavaScript'],
  },
  {
    slug: 'kubernetes-security-hardening',
    title: 'Kubernetes 安全強化檢查清單',
    excerpt: '生產環境 Kubernetes 叢集的必備安全配置與最佳實踐。',
    date: '2023-12-10',
    readTime: 18,
    tags: ['Kubernetes', 'DevOps', '資安'],
  },
];

// Get unique tags
const allTags = [...new Set(posts.flatMap(post => post.tags))];
---

<Layout title={`${t.blog.title} | ${t.site.title}`} description={t.blog.description}>
  <section class="section">
    <div class="container">
      <!-- Page Header -->
      <div class="page-header">
        <h1>{t.blog.title}</h1>
        <p>{t.blog.description}</p>
      </div>

      <!-- Tags Filter -->
      <div class="tags-filter">
        <span class="filter-label">{t.blog.tags}:</span>
        <div class="tags-list">
          <button class="tag active" data-tag="all">{t.blog.allPosts}</button>
          {allTags.map(tag => (
            <button class="tag" data-tag={tag}>{tag}</button>
          ))}
        </div>
      </div>

      <!-- Blog Posts Grid -->
      <div class="posts-grid">
        {posts.map(post => (
          <article class="post-card" data-tags={post.tags.join(',')}>
            <div class="post-meta">
              <time datetime={post.date}>
                {new Date(post.date).toLocaleDateString('zh-TW', { 
                  year: 'numeric', 
                  month: 'long', 
                  day: 'numeric' 
                })}
              </time>
              <span class="read-time">{post.readTime} {t.blog.minRead}</span>
            </div>
            <h2><a href={getTranslatedPath(`blog/${post.slug}`, lang)}>{post.title}</a></h2>
            <p>{post.excerpt}</p>
            <div class="post-tags">
              {post.tags.map(tag => (
                <span class="tag tag-primary">{tag}</span>
              ))}
            </div>
            <a href={getTranslatedPath(`blog/${post.slug}`, lang)} class="read-more">
              {t.blog.readMore}
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
              </svg>
            </a>
          </article>
        ))}
      </div>
    </div>
  </section>
</Layout>

<style>
  .page-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .page-header h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  .page-header p {
    color: var(--color-text-secondary);
    max-width: 600px;
    margin: 0 auto;
  }

  /* Tags Filter */
  .tags-filter {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .filter-label {
    font-weight: 500;
    color: var(--color-text-secondary);
  }

  .tags-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tags-list .tag {
    cursor: pointer;
    border: none;
    transition: all 0.2s ease;
  }

  .tags-list .tag:hover,
  .tags-list .tag.active {
    background-color: var(--color-accent);
    color: white;
  }

  /* Posts Grid */
  .posts-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
  }

  .post-card {
    padding: 1.5rem;
    background-color: var(--color-card-bg);
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    transition: all 0.2s ease;
  }

  .post-card:hover {
    border-color: var(--color-border-hover);
    transform: translateY(-2px);
  }

  .post-card.hidden {
    display: none;
  }

  .post-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.75rem;
    font-size: 0.875rem;
    color: var(--color-text-tertiary);
  }

  .read-time {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .read-time::before {
    content: '•';
    margin-right: 0.5rem;
  }

  .post-card h2 {
    font-size: 1.25rem;
    margin-bottom: 0.75rem;
    line-height: 1.4;
  }

  .post-card h2 a {
    color: var(--color-text);
  }

  .post-card h2 a:hover {
    color: var(--color-accent);
  }

  .post-card > p {
    color: var(--color-text-secondary);
    font-size: 0.875rem;
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .post-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .read-more {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
  }

  @media (max-width: 768px) {
    .posts-grid {
      grid-template-columns: 1fr;
    }

    .tags-filter {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>

<script>
  function initTagFilter() {
    const tags = document.querySelectorAll('.tags-list .tag');
    const posts = document.querySelectorAll('.post-card');

    tags.forEach(tag => {
      tag.addEventListener('click', () => {
        // Update active state
        tags.forEach(t => t.classList.remove('active'));
        tag.classList.add('active');

        const selectedTag = tag.getAttribute('data-tag');

        // Filter posts
        posts.forEach(post => {
          const postTags = post.getAttribute('data-tags')?.split(',') || [];
          if (selectedTag === 'all' || postTags.includes(selectedTag)) {
            post.classList.remove('hidden');
          } else {
            post.classList.add('hidden');
          }
        });
      });
    });
  }

  initTagFilter();
  document.addEventListener('astro:after-swap', initTagFilter);
</script>
